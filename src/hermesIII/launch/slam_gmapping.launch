<?xml version="1.0" encoding="UTF-8"?>
<!-- Entry point for using OpenNI devices -->
<launch>
	<!-- INCLUIMOS EL LAUNCH-FILE DEL ALGORITMO ORB SLAM V2 RGBD, QUE A SU VEZ DENTRO DE ESTE SE INCLUYE AL LAUNCH-FILE DE FREENECT-->
	<include file="$(find hermesIII)/launch/kinect_orbslam2.launch"/>
	
	<!-- EJECUTAMOS LO QUE TRANSFORMA DE DATOS DE PROFUNDIDAD A TIPO SCAN -->
	<node name="depthimage_to_laserscan" pkg="depthimage_to_laserscan" type="depthimage_to_laserscan" >
		<!--<param name="scan_height" value="4"/>-->
		<!--<param name="range_min" value="0.01"/>-->
		<!--<param name="range_max" value="20"/>-->
		<remap from="image" to="/camera/depth_registered/image_raw"/>
	</node>

	<node pkg="tf" type="static_transform_publisher" name="base_to_camera" args="0.0 0.0 0.0 0.0 0.0 0.0 /base_link /camera_link 100" />

	<node pkg="gmapping" type="slam_gmapping" name="slam_gmapping" output="screen">
        	<!--remap from="scan" to="base_scan"/-->
        	<!--param name="odom_frame" value="odom"/-->
		<!-- ESPECIFICAMOS EL BASE FRAME Y EL ODOM FRAME SEGUN TF_VIEWER -->
		<!--<remap from="scan" to="base_scan"/>-->
		<param name="map_frame" value="map"/>		
		<param name="base_frame" value="base_link"/>
		<param name="odom_frame" value="odom"/>
        	<!-- Parametros de Kinect-->
        	<param name="inverted_laser" value="false"/> <!-- Is the laser right side up (scans are ordered CCW), or upside down (scans are ordered CW)? -->
	        <param name="throttle_scans" value="1"/> <!-- (int, default: 1) Process 1 out of every this many scans (set it to a higher number to skip more scans)  -->
	        <param name="map_update_interval" value="0.5"/> <!-- (float, default: 5.0) How long (in seconds) between updates to the map. Lowering this number updates the occupancy grid more often, at the expense of greater computational load.  -->
	        <param name="maxUrange" value="80.0"/> <!-- (float, default: 80.0) The maximum usable range of the laser. A beam is cropped to this value.  -->
        	<param name="sigma" value="0.01"/> <!-- (float, default: 0.05) The sigma used by the greedy endpoint matching  -->
	        <param name="kernelSize" value="1"/> <!-- (int, default: 1) The kernel in which to look for a correspondence  -->
	        <param name="lstep" value="0.05"/> <!--  (float, default: 0.05) The optimization step in translation  -->
	        <param name="astep" value="0.05"/> <!-- (float, default: 0.05) The optimization step in rotation  -->
	        <param name="iterations" value="5"/> <!-- (int, default: 5) The number of iterations of the scanmatcher  -->
	        <param name="lsigma" value="0.075"/> <!-- (float, default: 0.075) The sigma of a beam used for likelihood computation  -->
	        <param name="ogain" value="3.0"/> <!-- (float, default: 3.0) Gain to be used while evaluating the likelihood, for smoothing the resampling effects  -->
	        <param name="lskip" value="30"/> <!-- (int, default: 0) Number of beams to skip in each scan.  -->
	        <param name="minimumScore" value="150.0"/> <!-- (float, default: 0.0) Minimum score for considering the outcome of the scan matching good. Can avoid jumping pose estimates in large open spaces when using laser scanners with limited range (e.g. 5m). Scores go up to 600+, try 50 for example when experiencing jumping estimate issues.  -->
	        <param name="srr" value="0.01"/> <!-- (float, default: 0.1) Odometry error in translation as a function of translation (rho/rho) -->
	        <param name="srt" value="0.02"/> <!-- (float, default: 0.2) Odometry error in translation as a function of rotation (rho/theta)  -->
	        <param name="str" value="0.01"/> <!-- (float, default: 0.1) Odometry error in rotation as a function of translation (theta/rho)  -->
	        <param name="stt" value="0.02"/> <!-- (float, default: 0.2) Odometry error in rotation as a function of rotation (theta/theta)  -->
	        <param name="linearUpdate" value="0.001"/> <!-- (float, default: 1.0) Process a scan each time the robot translates this far -->
	        <param name="angularUpdate" value="0.001"/>  <!-- (float, default: 0.5) Process a scan each time the robot rotates this far -->
	        <param name="temporalUpdate" value="-1.0"/> <!-- (float, default: -1.0) Process a scan if the last scan processed is older than the update time in seconds. A value less than zero will turn time based updates off.  -->
	        <param name="resampleThreshold" value="0.5"/> <!-- (float, default: 0.5) The Neff based resampling threshold  -->
	        <param name="particles" value="10"/> <!-- (int, default: 30) Number of particles in the filter  -->
	        <param name="xmin" value="-10.0"/> <!-- (float, default: -100.0) Initial map size  -->
	        <param name="ymin" value="-10.0"/> <!-- (float, default: -100.0) Initial map size  -->
	        <param name="xmax" value="10.0"/> <!-- (float, default: 100.0) Initial map size  -->
	        <param name="ymax" value="10.0"/> <!-- (float, default: 100.0) Initial map size  -->
	        <param name="delta" value="0.05"/> <!-- (float, default: 0.05) Resolution of the map  -->
	        <param name="llsamplerange" value="0.0001"/> <!-- (float, default: 0.01) Translational sampling range for the likelihood  -->
	        <param name="llsamplestep" value="0.0001"/> <!-- (float, default: 0.01) Translational sampling step for the likelihood  -->
	        <param name="lasamplerange" value="0.0001"/> <!-- (float, default: 0.005) Angular sampling range for the likelihood  -->
	        <param name="lasamplestep" value="0.0001"/> <!-- (float, default: 0.005) Angular sampling step for the likelihood  -->
	        <param name="transform_publish_period" value="0.05"/> <!--  (float, default: 0.05) How long (in seconds) between transform publications.  -->
	        <param name="occ_thresh" value="0.25"/> <!-- (float, default: 0.25) Threshold on gmapping's occupancy values. Cells with greater occupancy are considered occupied (i.e., set to 100 in the resulting sensor_msgs/LaserScan).  -->
	        <param name="maxRange" value="80.0"/> <!-- (float) The maximum range of the sensor. If regions with no obstacles within the range of the sensor should appear as free space in the map, set maxUrange < maximum range of the real sensor <= maxRange.  -->
	</node>

	<!-- CORREMOS RVIZ CON LAS CONFIGURACIONES PRECARGADAS -->
	<node pkg="rviz" type="rviz" name="rviz" args="-d $(find freenect_launch)/launch/rviz_hectormapping.rviz"/>
	
</launch>
